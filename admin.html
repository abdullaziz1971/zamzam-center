<!DOCTYPE html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© â€“ v2</title>
<link rel="stylesheet" href="admin.css">
<style>body{background:#f6f7fb;margin:0}</style>
</head><body>
<header class="tools">
  <button id="btnReload">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
  <button id="btnSave">Ø­ÙØ¸</button>
  <!-- Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª -->
  <button id="openOfferPicker">Ø¥Ø¶Ø§ÙØ© Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª Ù„Ù„Ø¹Ø±Ø¶</button>

  <input id="siteName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
  <input id="wa" placeholder="ÙˆØ§ØªØ³Ø§Ø¨">
  <input id="admPwd" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± (ØªÙØ­ÙØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§)">
  <span id="srcBadge" class="badge">â€”</span>
  <span id="msg"></span>
</header>

<section class="sec">
  <h3>Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù…ÙŠØ²</h3>
  <button id="addFeaturedItem">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</button>
  <table id="tblFeatured">
    <thead><tr>
      <th class="col-lg">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
      <th class="col-md">Ø§Ù„ÙˆØ­Ø¯Ø©</th>
      <th class="col-sm pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</th>
      <th class="col-sm price">Ø§Ù„Ø³Ø¹Ø±</th>
      <th class="col-sm price">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù…ÙŠØ²</th>
      <th class="col-sm">ÙØ±Ù‚ Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
      <th class="col-md">ØµÙˆØ±Ø©</th>
    </tr></thead>
    <tbody></tbody>
  </table>
  <p class="small-note">Ø­ÙØ°ÙØª Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø­Ø°Ù/Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬ â€” Ø§Ø³ØªØ®Ø¯Ù… ÙƒØ¨Ø³Ø© Ø§Ù„ÙØ£Ø±Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ù„Ø¥Ø¯Ø±Ø§Ø¬ Ø£Ùˆ Ø­Ø°Ù.</p>
</section>

<section class="sec">
  <h3>Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ù‚ÙˆÙŠ</h3>
  <button id="addStrongItem">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</button>
  <table id="tblStrong">
    <thead><tr>
      <th class="col-lg">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© (B)</th>
      <th class="col-md">Ø§Ù„ÙˆØ­Ø¯Ø© (B)</th>
      <th class="col-sm pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø© (B)</th>
      <th class="col-lg">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© (A)</th>
      <th class="col-md">Ø§Ù„ÙˆØ­Ø¯Ø© (A)</th>
      <th class="col-sm pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø© (A)</th>
      <th class="col-sm price">Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ù…Ø¬</th>
      <th class="col-md">ØµÙˆØ±Ø©</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</section>

<section class="sec">
  <h3>Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ø­Ø±</h3>
  <button id="addFreeItem">Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ±</button>
  <table id="tblFree">
    <thead><tr>
      <th class="col-lg">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© (B)</th>
      <th class="col-md">Ø§Ù„ÙˆØ­Ø¯Ø© (B)</th>
      <th class="col-sm pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø© (B)</th>
      <th class="col-sm price">Ø³Ø¹Ø± (B) â€” Ù…Ø®ÙÙŠ</th>
      <th class="col-md">Ø§Ù„Ø´Ø±ÙƒØ© (B)</th>
      <th class="col-lg">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© (A)</th>
      <th class="col-md">Ø§Ù„ÙˆØ­Ø¯Ø© (A)</th>
      <th class="col-sm pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø© (A)</th>
      <th class="col-sm price">Ø³Ø¹Ø± (A) â€” Ù…Ø®ÙÙŠ</th>
      <th class="col-md">Ø§Ù„Ø´Ø±ÙƒØ© (A)</th>
      <th class="col-md">ØµÙˆØ±Ø©</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</section>

<section class="sec">
  <h3>Ø§Ù„Ø´Ø±ÙƒØ§Øª</h3>
  <button id="addCompany">Ø¥Ø¶Ø§ÙØ© Ø´Ø±ÙƒØ©</button>
  <table id="tblCompanies">
    <thead><tr>
      <th class="col-lg">Ø§Ù„Ø§Ø³Ù…</th>
      <th class="col-md">Ø§Ù„Ù…Ø¹Ø±Ù‘Ù</th>
      <th class="col-md">Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</th>
      <th class="col-md">Ø§Ù„Ø´Ø¹Ø§Ø±</th>
      <th class="col-lg">Ø§Ù„ÙˆØµÙ</th>
      <th class="col-sm">Ø¥Ø¸Ù‡Ø§Ø± Ø¨Ø§Ù„Ø´Ø±ÙƒØ§Øª</th>
      <th class="col-sm">Ù…ÙØ¹Ù‘Ù„</th>
      <th class="col-sm">ØªØ±ØªÙŠØ¨</th>
      <th class="col-sm">Ù‡Ø§Ù…Ø´ ÙˆØ­Ø¯Ø© 1 %</th>
    </tr></thead>
    <tbody></tbody>
  </table>
</section>

<section class="sec">
  <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
  <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
    <select id="companySelect"></select>
    <button id="addProduct">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
    <button id="pasteExcel">Ù„ØµÙ‚ Ù…Ù† Ø¥ÙƒØ³Ù„</button>
  </div>

  <table id="tblProducts" class="compact">
    <colgroup>
      <col class="col-lg"><!-- Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© -->
      <col class="col-lg"><!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
      <col class="col-md"><!-- u1 name -->
      <col class="col-sm"><!-- price1 -->
      <col class="col-sm"><!-- min u1 -->
      <col class="col-md"><!-- u2 name -->
      <col class="col-sm"><!-- pack2 -->
      <col class="col-sm"><!-- price2 -->
      <col class="col-md"><!-- u3 name -->
      <col class="col-sm"><!-- pack3 -->
      <col class="col-sm"><!-- price3 -->
      <col class="col-sm"><!-- free pack -->
      <col class="col-sm"><!-- free price -->
      <col class="col-sm"><!-- status -->
      <col class="col-sm"><!-- code -->
      <col class="col-sm"><!-- visible -->
      <col class="col-md"><!-- image -->
    </colgroup>
    <thead><tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
      <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
      <th>Ø§Ù„ÙˆØ­Ø¯Ø© 1 (Ø§Ù„Ø§Ø³Ù…)</th>
      <th class="price">Ø§Ù„Ø³Ø¹Ø± 1</th>
      <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ (ÙˆØ­Ø¯Ø© 1)</th>
      <th>Ø§Ù„ÙˆØ­Ø¯Ø© 2 (Ø§Ù„Ø§Ø³Ù…)</th>
      <th class="pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø© 2 (Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø© 1)</th>
      <th class="price">Ø§Ù„Ø³Ø¹Ø± 2</th>
      <th>Ø§Ù„ÙˆØ­Ø¯Ø© 3 (Ø§Ù„Ø§Ø³Ù…)</th>
      <th class="pack">Ø§Ù„ØªØ¹Ø¨Ø¦Ø© 3 (Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø© 1)</th>
      <th class="price">Ø§Ù„Ø³Ø¹Ø± 3</th>
      <th>Ø§Ù„ØªØ¹Ø¨Ø¦Ø© (Ø­Ø±)</th>
      <th>Ø§Ù„Ø³Ø¹Ø± (Ø­Ø±)</th>
      <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      <th>ÙƒÙˆØ¯</th>
      <th>Ø§Ù„Ø¸Ù‡ÙˆØ±</th>
      <th>ØµÙˆØ±Ø©</th>
    </tr></thead>
    <tbody></tbody>
  </table>
  <p class="small-note">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø­Ø°Ù Ùˆ# Ø£ÙØ²ÙŠÙ„Øª. Ù„Ù„Ø¥Ø¯Ø±Ø§Ø¬/Ø§Ù„Ø­Ø°Ù Ø§Ù†Ù‚Ø± Ø¨Ø²Ø±Ù‘ Ø§Ù„ÙØ£Ø±Ø© Ø§Ù„Ø£ÙŠÙ…Ù† Ø¹Ù„Ù‰ Ø§Ù„ØµÙ.</p>
</section>

<!-- Rightâ€‘click menu -->
<div id="ctxMenu" role="menu" aria-hidden="true">
  <div class="item" data-act="before">â• Ø¥Ø¯Ø±Ø§Ø¬ ØµÙ ÙÙˆÙ‚</div>
  <div class="item" data-act="after">â• Ø¥Ø¯Ø±Ø§Ø¬ ØµÙ ØªØ­Øª</div>
  <div class="item" data-act="delete">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ØµÙ</div>
</div>

<!-- Load data then admin JS -->
<script src="/data.js"></script>
<script src="admin.js?v=ui-compact3" defer></script>

<!-- ===== Patch: ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ù„ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¨Ø¯ÙˆÙ† Ù„Ù…Ø³ admin.js ===== -->
<script>
window.addEventListener('load', function(){
  (function(){
    var menu = document.getElementById('ctxMenu');
    if(!menu) return;

    function attachContextMenuFor(tableId){
      document.addEventListener('contextmenu', function(e){
        var t = e.target && e.target.closest('#'+tableId+' tbody td, #'+tableId+' tbody tr');
        if(!t) return;
        var tr = t.closest('tr'); if(!tr) return;
        var row = Array.prototype.indexOf.call(tr.parentNode.children, tr);
        var vw = window.innerWidth, vh = window.innerHeight;
        var mw = menu.offsetWidth||180, mh = menu.offsetHeight||120;
        var x = Math.min(e.clientX, vw - mw - 8);
        var y = Math.min(e.clientY, vh - mh - 8);
        menu.style.left = x + 'px';
        menu.style.top  = y + 'px';
        menu.style.display = 'block';
        menu.dataset.rowIndex = String(row);
        menu.dataset.table = tableId;
        e.preventDefault();
      });
    }

    document.addEventListener('click', function(ev){
      var item = ev.target && ev.target.closest('#ctxMenu .item');
      if(!item) return;
      var table = menu.dataset.table || 'tblProducts';
      if(table === 'tblProducts') return;
      ev.preventDefault();
      ev.stopPropagation();

      function hide(){ menu.style.display='none'; menu.dataset.rowIndex=''; menu.dataset.table=''; }
      var i = Math.max(0, parseInt(menu.dataset.rowIndex||'0',10));
      var act = item.getAttribute('data-act');

      if(table === 'tblFeatured'){
        var list = (STATE.featuredOffers.items = STATE.featuredOffers.items || []);
        var blank = { id: Date.now(), title:'', unit:'', packaging:'', originalPrice:'', discountedPrice:'', image:'' };
        if(act==='before' || act==='after'){ list.splice(act==='before'?i:i+1, 0, blank); }
        else if(act==='delete'){ list.splice(i,1); }
        renderFeatured(); hide(); return;
      }

      if(table === 'tblStrong'){
        var listS = (STATE.mergedOffers.strong.items = STATE.mergedOffers.strong.items || []);
        var blankS = { id:Date.now(), pairA_title:'', pairA_unit:'', pairA_packaging:'', pairB_title:'', pairB_unit:'', pairB_packaging:'', price:'', image:'' };
        if(act==='before' || act==='after'){ listS.splice(act==='before'?i:i+1, 0, blankS); }
        else if(act==='delete'){ listS.splice(i,1); }
        renderStrong(); hide(); return;
      }

      if(table === 'tblFree'){
        var listF = (STATE.mergedOffers.free.items = STATE.mergedOffers.free.items || []);
        var blankF = { id:Date.now(), groupA_title:'', groupA_unit:'', groupA_packaging:'', groupA_priceHidden:'', groupA_company:'', groupB_title:'', groupB_unit:'', groupB_packaging:'', groupB_priceHidden:'', groupB_company:'', image:'' };
        if(act==='before' || act==='after'){ listF.splice(act==='before'?i:i+1, 0, blankF); }
        else if(act==='delete'){ listF.splice(i,1); }
        renderFree(); hide(); return;
      }

      if(table === 'tblCompanies'){
        var listC = (STATE.companies = STATE.companies || []);
        var blankC = { id:'c'+Date.now(), name:'Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©', icon:'', logo:'', description:'', active:true, displayOrder:listC.length+1, settings:{showUnits:'unit2', marginU1:5}, products:[] };
        if(act==='before' || act==='after'){ listC.splice(act==='before'?i:i+1, 0, blankC); }
        else if(act==='delete'){ listC.splice(i,1); }
        renderCompanies(); renderCompanySelect(); renderProducts(); hide(); return;
      }
    }, true);

    ['tblFeatured','tblStrong','tblFree','tblCompanies'].forEach(attachContextMenuFor);
  })();
});
</script>

<!-- ==== Modal: Ø§Ø®ØªÙŠØ§Ø± Ø´Ø±ÙƒØ© ÙˆÙ…Ù†ØªØ¬ Ù„Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¹Ø±ÙˆØ¶ ==== -->
<div id="offerPicker" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:9999;align-items:center;justify-content:center">
  <div style="background:#fff;min-width:720px;max-width:95vw;max-height:90vh;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,.25);padding:12px;overflow:auto">
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">
      <strong>Ø¥Ø¶Ø§ÙØ© Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø¥Ù„Ù‰:</strong>
      <select id="op_type">
        <option value="featured">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù…ÙŠØ²</option>
        <option value="strongA">Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ù‚ÙˆÙŠ (Ø·Ø±Ù A)</option>
        <option value="freeA">Ø§Ù„Ø¯Ù…Ø¬ Ø§Ù„Ø­Ø± (Ø·Ø±Ù A)</option>
      </select>
      <span style="margin-inline-start:auto"></span>
      <button id="op_close">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <div class="grid2" style="display:grid;grid-template-columns:240px 1fr;gap:10px">
      <div>
        <label>Ø§Ù„Ø´Ø±ÙƒØ©</label>
        <select id="op_company" style="width:100%;margin:6px 0"></select>
        <input id="op_search" type="text" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬â€¦" style="width:100%">
      </div>
      <div style="max-height:60vh;overflow:auto;border:1px solid #e6e8ef;border-radius:8px">
        <table style="width:100%;border-collapse:collapse">
          <thead>
            <tr>
              <th style="border-bottom:1px solid #e6e8ef;padding:8px">Ø§Ù„ØµÙ†Ù</th>
              <th style="border-bottom:1px solid #e6e8ef;padding:8px">Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</th>
              <th style="border-bottom:1px solid #e6e8ef;padding:8px;width:120px">Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody id="op_body"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

</body></html>
