<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Meta Pixel (Zamzam) -->
  <script>
  !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
  n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement('script');
  t.async=!0;t.src='https://connect.facebook.net/en_US/fbevents.js';
  s=b.getElementsByTagName('script')[0];s.parentNode.insertBefore(t,s)}(window,document,'script');
  fbq('init','533218603729121');
  fbq('track','PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=533218603729121&ev=PageView&noscript=1"/></noscript>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3MB80QG8CE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-3MB80QG8CE');
  </script>
  <title>Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´Ø±ÙƒØ§Øª | Ø²Ù…Ø²Ù… Ø¬Ù…Ù„Ø©</title>
  <style>
    :root{--ink:#0b0b0b;--bg:#ffffff;--navy:#0d2240;--lav:#b794f4;--muted:#4b5563;--border:#e5e7eb;--green:#16a34a}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:"Tajawal",system-ui,-apple-system,"Segoe UI",Roboto,Arial}
    .page{max-width:1100px;margin:16px auto;padding:0 16px;border:4px solid var(--lav);border-radius:18px;background:#fff}
    header{background:var(--navy);color:#fff;border-radius:12px;margin:16px 16px 0;padding:24px 16px 12px;text-align:center}
    header img{display:block;margin:0 auto 10px;width:180px;max-width:200px;}
    header h1{font-size:clamp(28px,4vw,44px);font-weight:900;margin:5px 0 10px 0;}
    .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin:12px 16px;justify-content:center;}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:10px;border:1px solid var(--border);background:#f8fafc;color:#111;text-decoration:none;font-weight:700}
    .btn:hover{background:#e5e7eb}
    .card{border:1px solid var(--border);border-radius:12px;background:#fff;margin:16px;padding-bottom:10px}
    .card h2{margin:0;padding:12px 14px 4px 14px;border-bottom:1px solid var(--border);font-size:22px;font-weight:900;}
    .card .description{padding:8px 14px;color:var(--muted);font-size:14px;font-style:italic}
    .table-wrap{overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{background:#f3f4f6;text-align:right;color:#111;padding:10px;border-bottom:1px solid var(--border);font-weight:800}
    tbody td{padding:10px;border-bottom:1px solid var(--border);vertical-align:top}
    tbody tr:hover{background:#fafafa}
    .price{font-weight:800;color:#16a34a}
    .note{color:var(--muted);font-size:12px}
    .unavailable{color:#b91c1c;font-weight:700}
    footer{padding:14px 16px;border-top:1px dashed var(--border);margin:0 16px 16px;color:var(--muted);text-align:center}
    .fab-order{position:fixed;left:16px;bottom:16px;z-index:999;display:flex;align-items:center;gap:10px;background:#0d2240;color:#fff;padding:12px 18px;border-radius:999px;box-shadow:0 8px 20px rgba(0,0,0,.25);border:1px solid #b794f4;text-decoration:none;font-weight:800;font-size:15px}
    .fab-order .badge{background:#16a34a;color:#fff;padding:4px 10px;border-radius:999px;font-size:13px;font-weight:900}
    @media (max-width:768px){
      .table-wrap{overflow-x:auto}
      thead th,tbody td{font-size:13px;padding:6px}
      tbody td:first-child, tbody td:nth-child(2){white-space:normal; word-break:break-word; max-width:260px;}
    }
    @media (max-width:768px){
      .table-wrap{overflow-x:auto}
      table{table-layout:auto !important;width:100%}
      thead{display:none}
      tbody td{display:block;width:100%;text-align:right;border:none;border-bottom:1px solid #e5e7eb;padding:6px 8px;white-space:normal;word-break:break-word;line-height:1.4}
      tbody tr{display:block;background:#fff;margin:10px 0;padding:8px 6px;border:1px solid #e5e7eb;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
      tbody td:nth-child(1){font-weight:900;font-size:15px;color:#111}
      tbody td:nth-child(2){color:#444;margin-top:4px}
      tbody td:nth-child(3){color:#555}
      tbody td:nth-child(4){font-weight:900;color:#16a34a;margin-top:4px}
      tbody td:nth-child(5){font-size:12px;color:#777;margin-top:4px}
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <img src="logo.png" alt="Ø´Ø¹Ø§Ø± Ø²Ù…Ø²Ù… Ø¬ÙÙ…Ù„Ø©">
      <h1>ğŸ¢ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø´Ø±ÙƒØ§Øª</h1>
    </header>

    <div class="toolbar">
      <a class="btn" href="index.html">â¬…ï¸ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a class="btn" href="order.html" style="background:#16a34a;color:#fff">ğŸ›’ ØµÙØ­Ø© Ø·Ù„Ø¨ Ø§Ù„Ø´Ø±Ø§Ø¡</a>
    </div>

    <div id="companies-container"></div>

    <footer>Â© Ù…Ø±ÙƒØ² ÙŠÙ†Ø§Ø¨ÙŠØ¹ Ø²Ù…Ø²Ù… â€” Ø£Ø³Ø¹Ø§Ø± Ø¬Ù…Ù„Ø© ÙˆØªØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØ±Ø§ØªÙŠÙ†/Ø§Ù„Ø·Ø±ÙˆØ¯. Ø¨Ø¹Ø¶ Ø§Ù„Ø£ØµÙ†Ø§Ù Ø­ØªÙ‰ Ù†ÙØ§Ø¯ Ø§Ù„ÙƒÙ…ÙŠØ©.</footer>
  </div>

  <a href="order.html" class="fab-order">ğŸ›’ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† <span class="badge" id="cart-count">0</span></a>

  <script src="data.js"></script>
  <script src="compat-data-alias.js"></script>
  <script src="cart.js"></script>
  <script>
    async function preferFreshAdminJson(){
      try{
        const r = await fetch('/admin_v2/data.json?ts=' + Date.now(), {cache:'no-store'});
        if(!r.ok) return;
        const j = await r.json();
        const oldTs = (window.ZAMZAM_DATA && ZAMZAM_DATA.metadata && ZAMZAM_DATA.metadata.lastUpdate) ? new Date(ZAMZAM_DATA.metadata.lastUpdate) : null;
        const newTs = (j && j.metadata && j.metadata.lastUpdate) ? new Date(j.metadata.lastUpdate) : null;
        if(!oldTs || (newTs && newTs > oldTs)){ window.ZAMZAM_DATA = j; }
      }catch(_){}
    }

    function getCompanyIds(){
      const params = new URLSearchParams(window.location.search);
      const idsParam = params.get('ids');
      return idsParam ? idsParam.split(',').map(id=>id.trim()).filter(Boolean) : [];
    }

    function isProductAvailable(p){
      if (p.visible === false) return false;
      if (p.hasVariants && Array.isArray(p.variants)){
        return p.variants.some(v => v && v.price !== null && v.price !== undefined);
      }
      return (p.price !== null && p.price !== undefined);
    }

    function isActiveCompany(c){
  if(!c) return false;
  const active = !(c.active === false || c.active === 'false' || c.active === 0 || c.active === '0');
  const show   = !(c.showInCompanies === false || c.showInCompanies === 'false' || c.showInCompanies === 0 || c.showInCompanies === '0');
  return active && show; // [MOD]
}
    

    function loadCompanies(){
      const container = document.getElementById('companies-container');
      const companyIds = getCompanyIds();

      if (companyIds.length === 0){
        container.innerHTML = `
          <div class="card">
            <div style="padding:40px;text-align:center;color:var(--muted)">
              <h2>Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø´Ø±ÙƒØ§Øª</h2>
              <p>ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø´Ø±ÙƒØ© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
              <a href="index.html" class="btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            </div>
          </div>`;
        return;
      }

      companyIds.forEach(companyId => {
        const company = (ZAMZAM_DATA.companies||[]).find(c => c.id === companyId);
        if (!company || !isActiveCompany(company)) return;

        const products = (company.products || []).filter(isProductAvailable);

const card = document.createElement('section');
card.className = 'card';
card.id = `company-${company.id}`;
card.setAttribute('data-company-id', company.id);
card.setAttribute('data-company-name', company.name || '');

        let html = `<h2>${company.icon || ''} ${company.name}</h2>`;
        if (company.description) html += `<div class="description">${company.description}</div>`;
        html += `
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Ø§Ù„ØµÙ†Ù</th>
                     <th>Ø§Ù„ÙˆØµÙ/Ø§Ù„Ø­Ø¬Ù…</th>
                        <th>Ø§Ù„ØªØ¹Ø¨Ø¦Ø©</th>
                        <th style="width:120px">Ø§Ù„Ø³Ø¹Ø± (Ø¯.Ø£)</th>
                        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                      <th style="width:120px">Ø·Ù„Ø¨</th>
                </tr>
              </thead>
              <tbody>`;

        const productsByCategory = {};
        products.forEach(p => {
          const cat = p.category || 'Ø¹Ø§Ù…';
          (productsByCategory[cat] = productsByCategory[cat] || []).push(p);
        });

        Object.keys(productsByCategory).forEach(category => {
          if (Object.keys(productsByCategory).length > 1){
            html += `<tr class="category-header"><td colspan="5"><b>${category}</b></td></tr>`;
          }
          productsByCategory[category].forEach(product => {
            if (product.hasVariants && Array.isArray(product.variants)) {
              const variants = product.variants.filter(v => v && v.price !== null && v.price !== undefined);
              variants.forEach((variant) => {
                html += `
  <tr data-product-id="${product.id}" data-title="${product.title||''}">
    <td>${product.title}</td>
    <td>${product.description || 'â€”'}</td>
    <td>${variant.label || 'â€”'}</td>
    <td><span class="price">${ZamzamCart.formatPrice(variant.price)}</span></td>
    <td>${product.notes || ''}</td>
    <td>
      ${variant.price!=null ? `
        <button type="button"
          data-add-to-order
          data-company-id="${company.id}"
          data-company-name="${company.name||''}"
          data-product-id="${product.id}"
          data-title="${(product.title||'').replace(/"/g,'&quot;')}"
          data-price="${Number(variant.price)||0}"
          data-variant-index="${(product.variants||[]).indexOf(variant)}"
          data-variant-label="${(variant.label||'').replace(/"/g,'&quot;')}">
          Ø£Ø¶Ù Ù„Ù„Ø·Ù„Ø¨
        </button>` : 'â€”'}
    </td>
  </tr>`;
              });
            } else {
              html += `
  <tr data-product-id="${product.id}" data-title="${product.title||''}">
    <td>${product.title}</td>
    <td>${product.description || 'â€”'}</td>
    <td>${product.packaging || 'â€”'}</td>
    <td><span class="price">${ZamzamCart.formatPrice(product.price)}</span></td>
    <td class="note">${product.notes || ''}</td>
    <td>
      ${product.price!=null ? `
        <button type="button"
          data-add-to-order
          data-company-id="${company.id}"
          data-company-name="${company.name||''}"
          data-product-id="${product.id}"
          data-title="${(product.title||'').replace(/"/g,'&quot;')}"
          data-price="${Number(product.price)||0}">
          Ø£Ø¶Ù Ù„Ù„Ø·Ù„Ø¨
        </button>` : 'â€”'}
    </td>
  </tr>`;

            }
          });
        });

        html += `</tbody></table></div>`;
        card.innerHTML = html;
        container.appendChild(card);
      });
    }

    function updateCartBadge(){
      const cart = ZamzamCart.load();
      const badge = document.getElementById('cart-count');
      const totalItems = cart.items.reduce((sum, item) => sum + item.quantity, 0);
      if (badge){
        badge.textContent = totalItems;
        badge.style.display = totalItems > 0 ? 'inline-block' : 'none';
      }
    }

    document.addEventListener('DOMContentLoaded', async function(){
      await preferFreshAdminJson();
      loadCompanies();
      updateCartBadge();
    });
  </script>
  <script>
(function(){
  if (!window.ZamzamCart) return;

  function addItemAndGo(opts){
    var qtyStr = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©:', '1');
    var qty = parseInt(qtyStr, 10);
    if (!Number.isFinite(qty) || qty <= 0) return;

    var item = {
      id: opts.id,
      type: 'company',
      companyId: opts.companyId,
      companyName: opts.companyName,
      title: opts.title,
      price: Number(opts.price)||0,
      quantity: qty,
      variantIndex: (opts.variantIndex ?? null),
      variantLabel: (opts.variantLabel ?? null)
    };
    var cart = ZamzamCart.load();
    ZamzamCart.updateItem(cart, item);

    // ØªØ­ÙˆÙŠÙ„ Ù„ØµÙØ­Ø© Ø§Ù„Ø·Ù„Ø¨ Ù…ÙÙ„ØªØ±Ø© Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø´Ø±ÙƒØ©
    var cid = encodeURIComponent(opts.companyId||'');
    location.href = '/order.html?company=' + cid + '#company-' + cid;
  }

  // Ø§Ù„ØªÙ‚Ø§Ø· ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø¹Ù„Ù‘Ù…Ø© Ø¨Ù€ data-add-to-order
  document.addEventListener('click', function(e){
    var btn = e.target.closest('[data-add-to-order]');
    if (!btn) return;
    e.preventDefault();
    addItemAndGo({
      companyId:  btn.getAttribute('data-company-id') || '',
      companyName:btn.getAttribute('data-company-name') || '',
      id:         btn.getAttribute('data-product-id') || '',
      title:      btn.getAttribute('data-title') || '',
      price:      btn.getAttribute('data-price') || '',
      variantIndex: btn.hasAttribute('data-variant-index') ? parseInt(btn.getAttribute('data-variant-index'),10) : null,
      variantLabel: btn.getAttribute('data-variant-label') || null
    });
  }, true);
})();
</script>

</body>
</html>
